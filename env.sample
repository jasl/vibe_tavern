# =============================================================================
# Vibe Tavern Environment Variables
# =============================================================================
#
# This file documents all environment variables used by Vibe Tavern.
# Copy this file to .env and fill in the values.
#
# ⚠️ NEVER commit .env to version control!
#
# Quick setup:
#   cp env.sample .env
#   # Then edit .env and fill in the values below
#
# =============================================================================

# -----------------------------------------------------------------------------
# Database Configuration (Required for Docker/Production)
# -----------------------------------------------------------------------------
# PostgreSQL password. Used by docker-compose.yaml.
# Generate a strong password: openssl rand -base64 32
POSTGRES_PASSWORD=

# -----------------------------------------------------------------------------
# Rails Secret Keys (Required for Production)
# -----------------------------------------------------------------------------
# SECRET_KEY_BASE is used for all MessageVerifiers in Rails, including cookies.
# Generate: bundle exec rails secret
SECRET_KEY_BASE=

# -----------------------------------------------------------------------------
# Active Record Encryption (Required for Production)
# -----------------------------------------------------------------------------
# These keys encrypt sensitive data (e.g., API keys stored in database).
# Generate all three keys:
#   bundle exec rails db:encryption:init
#
# Then copy the output into these variables.
ACTIVE_RECORD_ENCRYPTION__PRIMARY_KEY=
ACTIVE_RECORD_ENCRYPTION__DETERMINISTIC_KEY=
ACTIVE_RECORD_ENCRYPTION__KEY_DERIVATION_SALT=

# -----------------------------------------------------------------------------
# Optional: Development Overrides
# -----------------------------------------------------------------------------
# Override Rails environment (default: development)
# RAILS_ENV=development

# Override Rails port (default: 3000)
# RAILS_PORT=3000

# Override database connection string base
# RAILS_DB_URL_BASE=postgresql://postgres:postgres@localhost:5432

# Skip demo data when running db:seed
# SKIP_DEMO_DATA=1

# -----------------------------------------------------------------------------
# Optional: SSL Configuration
# -----------------------------------------------------------------------------
# Force SSL in production (default: true in production)
# RAILS_FORCE_SSL=true

# Assume SSL termination by reverse proxy (default: true in production)
# RAILS_ASSUME_SSL=true

# -----------------------------------------------------------------------------
# Optional: Log Level
# -----------------------------------------------------------------------------
# Set log level (default: info in production, debug in development)
# RAILS_LOG_LEVEL=info

# -----------------------------------------------------------------------------
# Optional: Performance Tuning
# -----------------------------------------------------------------------------
# Max threads per Puma worker (default: 3)
# RAILS_MAX_THREADS=3

# Number of Puma workers (default: 1)
# RAILS_WEB_CONCURRENCY=1

# Database connection pool size (default: 10)
# Must be >= DEFAULT_QUEUE_JOB_THREADS + UPLOAD_QUEUE_JOB_THREADS + LLM_QUEUE_JOB_THREADS + 2 for SolidQueue to start.
# If not set, defaults to RAILS_MAX_THREADS or 10.
# RAILS_DB_POOL=10

# Run SolidQueue inside Puma process (default: false)
# SOLID_QUEUE_IN_PUMA=true

# -----------------------------------------------------------------------------
# Optional: Background Job Configuration
# -----------------------------------------------------------------------------
# Vibe Tavern uses three job queues:
#   - default: General tasks (cleanup, maintenance, etc.)
#   - uploads: File imports (characters, lorebooks, etc.)
#   - llm: AI generation tasks (I/O-bound API calls)
#
# Recommended configurations:
#   ┌─────────────────────────────────┬───────────────────────────────────────────────────────┐
#   │ Scenario                        │ Configuration                                         │
#   ├─────────────────────────────────┼───────────────────────────────────────────────────────┤
#   │ OpenAI/Claude/Gemini            │ LLM_QUEUE_JOB_THREADS=8~10                            │
#   │ High concurrency (20+ requests) │ LLM_QUEUE_JOB_THREADS=10, LLM_QUEUE_JOB_CONCURRENCY=2 │
#   │ Self-hosted models (single GPU) │ LLM_QUEUE_JOB_THREADS=1                               │
#   │ Self-hosted models (multi GPU)  │ LLM_QUEUE_JOB_THREADS=1, LLM_QUEUE_JOB_CONCURRENCY=N  │
#   │ Strict rate-limited providers   │ LLM_QUEUE_JOB_THREADS=2~3                             │
#   │ Process isolation (memory leak) │ Increase LLM_QUEUE_JOB_CONCURRENCY                    │
#   └─────────────────────────────────┴───────────────────────────────────────────────────────┘
#
# Default queue:
# Threads per process (default: 3)
# DEFAULT_QUEUE_JOB_THREADS=3
# Number of processes (default: 1)
# DEFAULT_QUEUE_JOB_CONCURRENCY=1
#
# Uploads queue:
# Threads per process (default: 2)
# UPLOAD_QUEUE_JOB_THREADS=2
# Number of processes (default: 1)
# UPLOAD_QUEUE_JOB_CONCURRENCY=1
#
# LLM queue:
# Threads per process (default: 5)
# LLM_QUEUE_JOB_THREADS=5
# Number of processes (default: 1)
# LLM_QUEUE_JOB_CONCURRENCY=1

# -----------------------------------------------------------------------------
# Optional: Token Estimation
# -----------------------------------------------------------------------------
# These are mainly for non-Rails usage of TavernKit::VibeTavern::TokenEstimation
# (or for overriding tokenizer assets path when credentials are blank).
#
# Root path used to resolve the default tokenizer directory (<root>/vendor/tokenizers).
# Required for non-Rails usage if you call TokenEstimation.estimator without passing root:.
# VIBE_TAVERN_ROOT=/absolute/path/to/vibe_tavern
#
# Optional: override tokenizer root path.
# In Rails, this is only used when `Rails.app.creds.option(:token_estimation, :tokenizer_root)` is blank/missing.
# If relative, it is resolved against VIBE_TAVERN_ROOT (or the configured root).
# TOKEN_ESTIMATION__TOKENIZER_ROOT=vendor/tokenizers
