{
 "config": [
  {
   "action": {
    "engine": "psql",
    "launcher": "query",
    "predicate": "Test",
    "sql": "WITH t_2_BuyEvent AS (SELECT * FROM (\n  \n    SELECT\n      1 AS purchase_id,\n      'Soap' AS item,\n      3 AS quantity UNION ALL\n  \n    SELECT\n      2 AS purchase_id,\n      'Milk' AS item,\n      1 AS quantity UNION ALL\n  \n    SELECT\n      3 AS purchase_id,\n      'Bread' AS item,\n      2 AS quantity UNION ALL\n  \n    SELECT\n      3 AS purchase_id,\n      'Coffee' AS item,\n      1 AS quantity UNION ALL\n  \n    SELECT\n      4 AS purchase_id,\n      'Firewood' AS item,\n      5 AS quantity UNION ALL\n  \n    SELECT\n      4 AS purchase_id,\n      'Soap' AS item,\n      1 AS quantity UNION ALL\n  \n    SELECT\n      5 AS purchase_id,\n      'Milk' AS item,\n      4 AS quantity UNION ALL\n  \n    SELECT\n      5 AS purchase_id,\n      'Bread' AS item,\n      1 AS quantity UNION ALL\n  \n    SELECT\n      5 AS purchase_id,\n      'Coffee' AS item,\n      2 AS quantity UNION ALL\n  \n    SELECT\n      6 AS purchase_id,\n      'Firewood' AS item,\n      1 AS quantity UNION ALL\n  \n    SELECT\n      6 AS purchase_id,\n      'Soap' AS item,\n      3 AS quantity UNION ALL\n  \n    SELECT\n      7 AS purchase_id,\n      'Milk' AS item,\n      1 AS quantity UNION ALL\n  \n    SELECT\n      7 AS purchase_id,\n      'Bread' AS item,\n      2 AS quantity UNION ALL\n  \n    SELECT\n      7 AS purchase_id,\n      'Coffee' AS item,\n      1 AS quantity UNION ALL\n  \n    SELECT\n      8 AS purchase_id,\n      'Firewood' AS item,\n      5 AS quantity UNION ALL\n  \n    SELECT\n      8 AS purchase_id,\n      'Soap' AS item,\n      1 AS quantity\n) AS UNUSED_TABLE_NAME  ),\nt_3_Items AS (SELECT * FROM (\n  \n    SELECT\n      'Soap' AS item,\n      20 AS price UNION ALL\n  \n    SELECT\n      'Milk' AS item,\n      10 AS price UNION ALL\n  \n    SELECT\n      'Bread' AS item,\n      5 AS price UNION ALL\n  \n    SELECT\n      'Coffee' AS item,\n      7 AS price UNION ALL\n  \n    SELECT\n      'Firewood' AS item,\n      15 AS price\n) AS UNUSED_TABLE_NAME  ),\nt_8_MoreExpensiveThan AS (SELECT\n  t_9_Items.item AS col0,\n  ARRAY_AGG(t_10_Items.item order by t_10_Items.item) AS logica_value\nFROM\n  t_3_Items AS t_9_Items, t_3_Items AS t_10_Items\nWHERE\n  (t_9_Items.price > t_10_Items.price)\nGROUP BY t_9_Items.item),\nt_17_Buyer AS (SELECT * FROM (\n  \n    SELECT\n      11 AS buyer_id,\n      1 AS purchase_id UNION ALL\n  \n    SELECT\n      12 AS buyer_id,\n      2 AS purchase_id UNION ALL\n  \n    SELECT\n      13 AS buyer_id,\n      3 AS purchase_id UNION ALL\n  \n    SELECT\n      14 AS buyer_id,\n      4 AS purchase_id UNION ALL\n  \n    SELECT\n      12 AS buyer_id,\n      5 AS purchase_id UNION ALL\n  \n    SELECT\n      13 AS buyer_id,\n      6 AS purchase_id UNION ALL\n  \n    SELECT\n      14 AS buyer_id,\n      7 AS purchase_id UNION ALL\n  \n    SELECT\n      11 AS buyer_id,\n      8 AS purchase_id\n) AS UNUSED_TABLE_NAME  ),\nt_0_Purchase AS (SELECT\n  Buyer.purchase_id AS purchase_id,\n  CAST((SELECT\n  ARRAY_AGG(((CASE WHEN x_23 = 0 THEN ROW(BuyEvent.item, ROW(BuyEvent.item, Items.price, BuyEvent.quantity)::logicarecord547335026)::logicarecord699137742 ELSE NULL END)).value order by ((CASE WHEN x_23 = 0 THEN ROW(BuyEvent.item, ROW(BuyEvent.item, Items.price, BuyEvent.quantity)::logicarecord547335026)::logicarecord699137742 ELSE NULL END)).arg) AS logica_value\nFROM\n  t_2_BuyEvent AS BuyEvent, t_3_Items AS Items, UNNEST(ARRAY[0]::numeric[]) as x_23\nWHERE\n  (BuyEvent.purchase_id = Buyer.purchase_id) AND\n  (Items.item = BuyEvent.item)) AS logicarecord547335026[]) AS items,\n  CAST((SELECT\n  ARRAY_AGG(((CASE WHEN x_42 = 0 THEN ROW(ROW(MoreExpensiveThan.col0, MoreExpensiveThan.logica_value)::logicarecord672603333, ROW(MoreExpensiveThan.col0, MoreExpensiveThan.logica_value)::logicarecord672603333)::logicarecord851083403 ELSE NULL END)).value order by ((CASE WHEN x_42 = 0 THEN ROW(ROW(MoreExpensiveThan.col0, MoreExpensiveThan.logica_value)::logicarecord672603333, ROW(MoreExpensiveThan.col0, MoreExpensiveThan.logica_value)::logicarecord672603333)::logicarecord851083403 ELSE NULL END)).arg) AS logica_value\nFROM\n  t_8_MoreExpensiveThan AS MoreExpensiveThan, UNNEST(CAST((SELECT\n    ARRAY_AGG(((CASE WHEN x_84 = 0 THEN ROW(t_13_BuyEvent.item, ROW(t_13_BuyEvent.item, t_14_Items.price, t_13_BuyEvent.quantity)::logicarecord547335026)::logicarecord699137742 ELSE NULL END)).value order by ((CASE WHEN x_84 = 0 THEN ROW(t_13_BuyEvent.item, ROW(t_13_BuyEvent.item, t_14_Items.price, t_13_BuyEvent.quantity)::logicarecord547335026)::logicarecord699137742 ELSE NULL END)).arg) AS logica_value\n  FROM\n    t_2_BuyEvent AS t_13_BuyEvent, t_3_Items AS t_14_Items, UNNEST(ARRAY[0]::numeric[]) as x_84\n  WHERE\n    (t_13_BuyEvent.purchase_id = Buyer.purchase_id) AND\n    (t_14_Items.item = t_13_BuyEvent.item)) AS logicarecord547335026[])) as x_39, UNNEST(ARRAY[0]::numeric[]) as x_42\nWHERE\n  (MoreExpensiveThan.col0 = (x_39).item)) AS logicarecord672603333[]) AS expensive_items,\n  Buyer.buyer_id AS buyer_id\nFROM\n  t_17_Buyer AS Buyer ORDER BY purchase_id, items, expensive_items, buyer_id)\nSELECT\n  (Purchase).*\nFROM\n  t_0_Purchase AS Purchase"
   },
   "name": "Test",
   "requires": [],
   "type": "final"
  }
 ],
 "data_dependency_edges": [],
 "dependency_edges": [],
 "engine": "psql",
 "final_predicates": [
  "Test"
 ],
 "iterations": {},
 "outputs": [
  {
   "kind": "table",
   "node": "Test",
   "predicate": "Test"
  }
 ],
 "preambles": [
  "-- Initializing PostgreSQL environment.\nset client_min_messages to warning;\ncreate schema if not exists logica_home;\n-- Empty logica type: logicarecord893574736;\nDO $$ BEGIN if not exists (select 'I(am) :- I(think)' from pg_type where typname = 'logicarecord893574736') then create type logicarecord893574736 as (nirvana numeric); end if; END $$;\n\n\nDO $$\nBEGIN\n-- Logica type: logicarecord481217614\nif not exists (select 'I(am) :- I(think)' from pg_type where typname = 'logicarecord481217614') then create type logicarecord481217614 as (r logicarecord893574736); end if;\n-- Logica type: logicarecord86796764\nif not exists (select 'I(am) :- I(think)' from pg_type where typname = 'logicarecord86796764') then create type logicarecord86796764 as (s text); end if;\n-- Logica type: logicarecord625776357\nif not exists (select 'I(am) :- I(think)' from pg_type where typname = 'logicarecord625776357') then create type logicarecord625776357 as (arg text, value text); end if;\n-- Logica type: logicarecord547335026\nif not exists (select 'I(am) :- I(think)' from pg_type where typname = 'logicarecord547335026') then create type logicarecord547335026 as (item text, price numeric, quantity numeric); end if;\n-- Logica type: logicarecord672603333\nif not exists (select 'I(am) :- I(think)' from pg_type where typname = 'logicarecord672603333') then create type logicarecord672603333 as (item text, more_expensive_than text[]); end if;\n-- Logica type: logicarecord699137742\nif not exists (select 'I(am) :- I(think)' from pg_type where typname = 'logicarecord699137742') then create type logicarecord699137742 as (arg text, value logicarecord547335026); end if;\n-- Logica type: logicarecord851083403\nif not exists (select 'I(am) :- I(think)' from pg_type where typname = 'logicarecord851083403') then create type logicarecord851083403 as (arg logicarecord672603333, value logicarecord672603333); end if;\n-- Logica type: logicarecord251409195\nif not exists (select 'I(am) :- I(think)' from pg_type where typname = 'logicarecord251409195') then create type logicarecord251409195 as (buyer_id numeric, expensive_items logicarecord672603333[], items logicarecord547335026[], purchase_id numeric); end if;\nEND $$;\n"
 ],
 "schema": "logica_rb.plan.v1"
}
